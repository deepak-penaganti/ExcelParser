<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WriteToExcel.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">excel-object-mapper</a> &gt; <a href="index.source.html" class="el_package">com.common.component.excel.write</a> &gt; <span class="el_source">WriteToExcel.java</span></div><h1>WriteToExcel.java</h1><pre class="source lang-java linenums">package com.common.component.excel.write;

import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Set;

import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.json.JSONArray;

import com.github.wnameless.json.flattener.JsonFlattener;

<span class="nc" id="L18">public class WriteToExcel {</span>


	/**
	 * Writes the JSON Array to Excel Workbook.
	 * 
	 * @param jsonArray
	 *            [JSONArray]
	 * @return workbook [org.apache.poi.xssf.usermodel.XSSFWorkbook]
	 */
	public static XSSFWorkbook write(JSONArray jsonArray) {
<span class="fc" id="L29">		XSSFWorkbook workbook = new XSSFWorkbook();</span>
<span class="fc" id="L30">		Sheet sheet = workbook.createSheet();</span>
<span class="fc" id="L31">		Row dataRow = null;</span>
<span class="fc" id="L32">		Row headerRow = null;</span>

<span class="fc" id="L34">		Map&lt;String, Integer&gt; headerIndexMap = new HashMap&lt;String, Integer&gt;();</span>
<span class="fc" id="L35">		Set&lt;String&gt; headersSet = new HashSet&lt;String&gt;();</span>
<span class="fc" id="L36">		int headerColumnCount = 0;</span>
<span class="fc" id="L37">		int headerRowCount = 0;</span>
<span class="fc" id="L38">		Cell headerCell = null;</span>
<span class="fc" id="L39">		headerRow = sheet.createRow(headerRowCount);</span>

		// Converts JSON Array to a map
		// More details : https://github.com/wnameless/json-flattener
<span class="fc" id="L43">		Map&lt;String, Object&gt; jsonMap = JsonFlattener.flattenAsMap(jsonArray.toString());</span>
<span class="fc" id="L44">		populateHeaders(jsonMap, headersSet);</span>

		// Populating the header row and creating the index map
<span class="fc bfc" id="L47" title="All 2 branches covered.">		for (String header : headersSet) {</span>
<span class="fc" id="L48">			headerCell = headerRow.createCell(headerColumnCount);</span>
<span class="fc" id="L49">			headerCell.setCellValue(header);</span>
<span class="fc" id="L50">			headerIndexMap.put(header, headerColumnCount);</span>
<span class="fc" id="L51">			headerColumnCount++;</span>
<span class="fc" id="L52">		}</span>
<span class="fc" id="L53">		populateDataRows(jsonMap, sheet, dataRow, headerIndexMap);</span>
<span class="fc" id="L54">		return workbook;</span>
	}

	/**
	 * Populates the unique headers.
	 * 
	 * @param jsonMap
	 *            [Map&lt;String, Object&gt;]
	 * @param headersSet
	 * 			  [Set&lt;String&gt;]
	 * @return void
	 */
	private static void populateHeaders(Map&lt;String, Object&gt; jsonMap, Set&lt;String&gt; headersSet) {
<span class="fc" id="L67">		Set&lt;String&gt; jsonKeySet = jsonMap.keySet();</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">		for (String jsonKey : jsonKeySet) {</span>
<span class="fc" id="L69">			String[] splitKeys = jsonKey.split(&quot;\\.&quot;);</span>
<span class="fc" id="L70">			headersSet.add(splitKeys[1]);</span>
<span class="fc" id="L71">		}</span>
<span class="fc" id="L72">	}</span>

	/**
	 * Populates the data values under proper headers.
	 * 
	 * @param jsonMap
	 *            [Map&lt;String, Object&gt;]
	 * @param sheet [Sheet]
	 * 
	 * @param dataRow [Row]
	 * 
	 * @param headerIndexMap [Map&lt;String, Integer&gt;]
	 *            
	 * @return void
	 */
	private static void populateDataRows(Map&lt;String, Object&gt; jsonMap, Sheet sheet, Row dataRow,
			Map&lt;String, Integer&gt; headerIndexMap) {
<span class="fc" id="L89">		Iterator&lt;Entry&lt;String, Object&gt;&gt; it = jsonMap.entrySet().iterator();</span>
<span class="fc bfc" id="L90" title="All 2 branches covered.">		while (it.hasNext()) {</span>
<span class="fc" id="L91">			Map.Entry&lt;String, Object&gt; entry = (Map.Entry&lt;String, Object&gt;) it.next();</span>
<span class="fc" id="L92">			String[] header = entry.getKey().split(&quot;\\.&quot;);</span>
<span class="fc" id="L93">			int columnNum = headerIndexMap.get(header[1]);</span>
			// Extracting the proper row number from the key string
<span class="fc" id="L95">			int rowNum = Integer.parseInt(entry.getKey().substring(1, 2)) + 1;</span>
<span class="pc bpc" id="L96" title="1 of 2 branches missed.">			if (sheet.getRow(rowNum) == null) {</span>
<span class="fc" id="L97">				dataRow = sheet.createRow(rowNum);</span>
			}
<span class="fc" id="L99">			Cell dataCell = dataRow.createCell(columnNum);</span>
<span class="fc" id="L100">			dataCell.setCellValue(entry.getValue().toString());</span>
<span class="fc" id="L101">		}</span>
<span class="fc" id="L102">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>